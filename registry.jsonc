{
	"$schema": "https://ocx.kdco.dev/schemas/registry.json",
	"name": "Worktree Orchestration",
	"namespace": "wto",
	"version": "1.2.0",
	"author": "liuxilong",
	"description": "Orchestrator Agent + Worktree + Issue + Gate 编排配置，支持多批次并行开发",

	"opencode": "1.0.0",
	"ocx": "1.0.16",

	"postInstall": [
		"# OpenCode 需要 opencode.jsonc 在项目根目录",
		"cp .opencode/opencode.jsonc opencode.jsonc",
		"echo '✅ 已创建 opencode.jsonc，请重启 OpenCode 并按 Tab 键选择 orchestrator'"
	],

	"components": [
		{
			"name": "orchestrator",
			"type": "ocx:agent",
			"description": "任务分解与批次编排 Agent，管理 Worktree + Issue + Gate 工作流",
			"files": ["agent/orchestrator.md"],
			"opencode": {
				"instructions": [".opencode/skills/batch/SKILL.md", ".opencode/skills/claim/SKILL.md"],
				"agent": {
					"orchestrator": {
						"mode": "primary",
						"permission": {
							"edit": "deny",
							"bash": {
								"*": "ask",
								"git *": "allow",
								"gh *": "allow"
							}
						}
					}
				}
			}
		},
		{
			"name": "reviewer",
			"type": "ocx:agent",
			"description": "Gate Review Agent，检查 PR 质量（Commit 格式、文件白名单、测试、禁止项）",
			"files": ["agent/reviewer.md"],
			"opencode": {
				"agent": {
					"reviewer": {
						"mode": "subagent",
						"permission": {
							"edit": "deny",
							"write": "deny",
							"bash": {
								"git *": "allow",
								"gh pr *": "allow",
								"rg *": "allow"
							}
						}
					}
				}
			}
		},
		{
			"name": "batch",
			"type": "ocx:skill",
			"description": "批次执行规约，定义多 Story 批次执行的标准流程",
			"files": ["skills/batch/SKILL.md"],
			"opencode": {
				"instructions": [".opencode/skills/batch/SKILL.md"]
			}
		},
		{
			"name": "claim",
			"type": "ocx:skill",
			"description": "任务认领规约，定义新 Worktree 实例如何认领任务",
			"files": ["skills/claim/SKILL.md"],
			"opencode": {
				"instructions": [".opencode/skills/claim/SKILL.md"]
			}
		},
		{
			"name": "full",
			"type": "ocx:bundle",
			"description": "完整编排配置，包含 orchestrator + reviewer + batch + claim",
			"files": [],
			"dependencies": ["orchestrator", "reviewer", "batch", "claim"],
			"postInstall": [
				"echo '⚠️  OpenCode 需要 opencode.jsonc 在项目根目录'",
				"cp .opencode/opencode.jsonc opencode.jsonc",
				"echo '✅ 已创建 opencode.jsonc，请重启 OpenCode 并按 Tab 键选择 orchestrator'"
			]
		}
	]
}
